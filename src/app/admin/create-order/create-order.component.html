<div class="row m-0 w-100 mt-4">
  <div class="col-7">
    <div class="bg-white p-3 rounded-3 h-100">
      <div class="" *ngIf="order">
        <nz-table [nzNoResult]="noResult">
          <thead>
            <tr>
              <th>Sản phẩm</th>
              <th>SL</th>
              <th>Đơn giá</th>
              <th>Thành tiền</th>
              <th>Imei</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let orderDetail of order.orderDetailDtos;
                let i_order_detail = index
              "
            >
              <td>
                <b>{{ orderDetail.productDetailCartDto.productName }}</b
                ><br />{{ orderDetail.productDetailCartDto.sku }}
              </td>
              <td>
                {{
                  orderDetail.imeiDtoList
                    ? orderDetail.imeiDtoList.length
                    : orderDetail.amount
                }}
              </td>
              <td>{{ orderDetail.priceSell | number }}đ</td>
              <td>
                {{ orderDetail.priceSell! * orderDetail.amount | number }}đ
              </td>
              <td>
                <ng-container
                  *ngFor="let imei of orderDetail.imeiDtoList; let i = index"
                >
                  <nz-tag
                    nzMode="closeable"
                    (nzOnClose)="
                      removeImei(i, i_order_detail, imei.id, orderDetail.id!)
                    "
                  >
                    {{ imei.imei }}
                  </nz-tag>
                  <br />
                </ng-container>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </div>
      <div class="m-3">
        <nz-input-group [nzSuffix]="suffixIconSearch">
          <input
            #searchBox
            type="text"
            [(ngModel)]="searchTerm"
            nz-input
            placeholder="input search text"
            (ngModelChange)="search(searchTerm)"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search"></span>
        </ng-template>
        <ng-container *ngFor="let product of products; let i_product = index">
          <div class="mt-3 mb-3 shadow-sm row">
            <div class="col-2">
              <img [src]="product.images[0]" alt="" width="100" />
            </div>
            <div class="col-10">
              <h5>
                <b>{{ product.productName }}</b>
              </h5>
              <ng-container
                *ngFor="let option of product.optionDtos; let i_option = index"
              >
                <p>{{ option.optionName }}</p>
                <div class="mb-2">
                  <ng-container
                    *ngFor="
                      let optionValue of option.optionValueDtos;
                      let i_optionValue = index
                    "
                  >
                    <button
                      nz-button
                      [nzType]="optionValue.selected ? 'primary' : 'default'"
                      (click)="
                        selectOptionValue(
                          i_option,
                          i_product,
                          i_optionValue,
                          optionValue.selected
                        )
                      "
                    >
                      {{ optionValue.optionValueName }}
                    </button>
                  </ng-container>
                </div>
              </ng-container>
              <button
                nz-button
                nzType="primary"
                (click)="openModalSelectImei(product)"
              >
                <span nz-icon nzType="shopping-cart"></span>
                Thêm vào đơn hàng
              </button>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
  <div class="col-5">
    <div>
      <div class="mb-3 p-3 rounded-3 bg-white">
        <h6>Thông tin khách hàng</h6>
        <app-customer-info
          [customer]="order.customerDTO"
          [isEdit]="isEdit"
        ></app-customer-info>
      </div>
      <div class="mb-3 p-3 rounded-3 bg-white">
        <h6>Thông tin thanh toán</h6>
        <div class="d-flex justify-content-between">
          <p>Tổng tiền</p>
          <p>{{ order.totalMoney | number }}đ</p>
        </div>
        <div class="d-flex justify-content-between">
          <p>Phí giao hàng</p>
          <p>{{ order.shipFee | number }}đ</p>
        </div>
        <div class="row d-flex justify-content-between">
          <p class="col-6">Khách thanh toán</p>
          <div class="col-6">
            <nz-input-number
              style="width: 100%"
              [(ngModel)]="order.checkout"
              [nzMin]="1"
              [nzMax]="order.totalMoney"
              [nzStep]="1"
            ></nz-input-number>
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <p>Còn thiếu</p>
          <p>{{ order.totalMoney - order.checkout | number }}đ</p>
        </div>
        <textarea
          nz-input
          placeholder="Ghi chú"
          [(ngModel)]="order.note"
          [nzAutosize]="{ minRows: 2, maxRows: 6 }"
          (ngModelChange)="noteChange($event)"
        ></textarea>
      </div>
      <div class="mb-3 p-3 rounded-3 bg-white">
        <h6>Thông tin giao hàng</h6>
        <app-delivery-info
          [address]="order.address"
          [delivery]="order.delivery!"
        ></app-delivery-info>
      </div>
      <div class="p-3 rounded-3 d-flex justify-content-end bg-white">
        <button nz-button nzType="default" nzSize="large" (click)="save()">
          <span nz-icon nzType="save" nzTheme="outline"></span>
          In hóa đơn
        </button>
        <button nz-button nzType="primary" nzSize="large" (click)="save()">
          <span nz-icon nzType="save" nzTheme="outline"></span>
          Lưu
        </button>
      </div>
    </div>
  </div>
</div>
<ng-template #noResult> </ng-template>
